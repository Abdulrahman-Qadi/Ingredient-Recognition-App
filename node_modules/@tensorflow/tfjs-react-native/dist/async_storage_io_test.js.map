{"version":3,"file":"async_storage_io_test.js","sourceRoot":"","sources":["../src/async_storage_io_test.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\n\nimport './platform_react_native';\n\nimport * as tf from '@tensorflow/tfjs-core';\n// tslint:disable-next-line: no-imports-from-dist\nimport {describeWithFlags} from '@tensorflow/tfjs-core/dist/jasmine_util';\n\nimport {asyncStorageIO} from './async_storage_io';\nimport {RN_ENVS} from './test_env_registry';\n\ndescribeWithFlags('AsyncStorageIO', RN_ENVS, () => {\n  // Test data.\n  const modelTopology1: {} = {\n    'class_name': 'Sequential',\n    'keras_version': '2.1.4',\n    'config': [{\n      'class_name': 'Dense',\n      'config': {\n        'kernel_initializer': {\n          'class_name': 'VarianceScaling',\n          'config': {\n            'distribution': 'uniform',\n            'scale': 1.0,\n            'seed': null,\n            'mode': 'fan_avg'\n          }\n        },\n        'name': 'dense',\n        'kernel_constraint': null,\n        'bias_regularizer': null,\n        'bias_constraint': null,\n        'dtype': 'float32',\n        'activation': 'linear',\n        'trainable': true,\n        'kernel_regularizer': null,\n        'bias_initializer': {'class_name': 'Zeros', 'config': {}},\n        'units': 1,\n        'batch_input_shape': [null, 3],\n        'use_bias': true,\n        'activity_regularizer': null\n      }\n    }],\n    'backend': 'tensorflow'\n  };\n\n  const weightSpecs1: tf.io.WeightsManifestEntry[] = [\n    {\n      name: 'dense/kernel',\n      shape: [3, 1],\n      dtype: 'float32',\n    },\n    {\n      name: 'dense/bias',\n      shape: [1],\n      dtype: 'float32',\n    }\n  ];\n  const weightData1 = new ArrayBuffer(16);\n\n  const artifacts1: tf.io.ModelArtifacts = {\n    modelTopology: modelTopology1,\n    weightSpecs: weightSpecs1,\n    weightData: weightData1,\n    format: 'layers-model',\n    generatedBy: 'TensorFlow.js v0.0.0',\n    convertedBy: null\n  };\n\n  const artifactsV0: tf.io.ModelArtifacts = {\n    modelTopology: modelTopology1,\n    weightSpecs: weightSpecs1,\n    weightData: weightData1\n  };\n\n  it('constructs an IOHandler', async () => {\n    const handler = asyncStorageIO('foo');\n    expect(typeof handler.load).toBe('function');\n    expect(typeof handler.save).toBe('function');\n  });\n\n  it('save returns a SaveResult', async () => {\n    const handler = asyncStorageIO('FooModel');\n    const result = await handler.save(artifacts1);\n    expect(result.modelArtifactsInfo).toBeDefined();\n    expect(result.modelArtifactsInfo).not.toBeNull();\n\n    expect(result.modelArtifactsInfo.modelTopologyType).toBe('JSON');\n    expect(result.modelArtifactsInfo.weightDataBytes).toBe(16);\n  });\n\n  it('Save-load round trip succeeds', async () => {\n    const handler = asyncStorageIO('FooModel');\n    await handler.save(artifacts1);\n\n    const handler2 = asyncStorageIO('FooModel');\n    const loaded = await handler2.load();\n\n    expect(loaded.modelTopology).toEqual(modelTopology1);\n    expect(loaded.weightSpecs).toEqual(weightSpecs1);\n    expect(loaded.weightData).toEqual(weightData1);\n    expect(loaded.format).toEqual('layers-model');\n    expect(loaded.generatedBy).toEqual('TensorFlow.js v0.0.0');\n    expect(loaded.convertedBy).toEqual(null);\n  });\n\n  it('Save-load round trip succeeds: v0 format', async () => {\n    const handler1 = asyncStorageIO('FooModel');\n    await handler1.save(artifactsV0);\n\n    const handler2 = asyncStorageIO('FooModel');\n    const loaded = await handler2.load();\n\n    expect(loaded.modelTopology).toEqual(modelTopology1);\n    expect(loaded.weightSpecs).toEqual(weightSpecs1);\n    expect(loaded.weightData).toEqual(weightData1);\n    expect(loaded.format).toEqual(undefined);\n    expect(loaded.generatedBy).toEqual(undefined);\n    expect(loaded.convertedBy).toEqual(undefined);\n  });\n});\n"]}