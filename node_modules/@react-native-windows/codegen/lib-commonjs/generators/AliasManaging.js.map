{"version":3,"file":"AliasManaging.js","sourceRoot":"","sources":["../../src/generators/AliasManaging.ts"],"names":[],"mappings":"AAAA;;;;GAIG;AAEH,YAAY,CAAC;;;AAIb,IAAI,mBAAmB,GAAW,EAAE,CAAC;AAErC,SAAgB,sBAAsB,CAAC,UAAkB;IACvD,mBAAmB,GAAG,UAAU,CAAC;AACnC,CAAC;AAFD,wDAEC;AAED,SAAgB,eAAe,CAAC,QAAgB;IAC9C,OAAO,GAAG,mBAAmB,QAAQ,QAAQ,EAAE,CAAC;AAClD,CAAC;AAFD,0CAEC;AAOD,MAAM,iBAAiB,GAAG,wBAAwB,CAAC;AAKnD,SAAS,qBAAqB,CAC5B,OAAiB,EACjB,aAAqB,EACrB,QAAwB;IAExB,QAAQ,CAAC,iBAAiB,CAAC,GAAG,aAAa,CAAC;IAC5C,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,GAAG,QAAQ,CAAC;IACxC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;IACjC,OAAO,aAAa,CAAC;AACvB,CAAC;AAED,SAAgB,wBAAwB,CACtC,OAAiB,EACjB,aAAqB,EACrB,UAA4C;IAE5C,iDAAiD;IACjD,6CAA6C;IAC7C,yBAAyB;IACzB,uFAAuF;IACvF,MAAM,QAAQ,GAAmB,UAAU,CAAC;IAC5C,MAAM,GAAG,GAAG,QAAQ,CAAC,iBAAiB,CAAC,CAAC;IACxC,IAAI,GAAG,KAAK,SAAS,EAAE;QACrB,OAAO,eAAe,CAAC,GAAG,CAAC,CAAC;KAC7B;IAED,iDAAiD;IACjD,+BAA+B;IAC/B,8DAA8D;IAC9D,IAAI,OAAO,CAAC,KAAK,CAAC,aAAa,CAAC,KAAK,SAAS,EAAE;QAC9C,OAAO,eAAe,CACpB,qBAAqB,CAAC,OAAO,EAAE,aAAa,EAAE,QAAQ,CAAC,CACxD,CAAC;KACH;IAED,qCAAqC;IACrC,IAAI,KAAK,GAAG,CAAC,CAAC;IACd,OAAO,OAAO,CAAC,KAAK,CAAC,GAAG,aAAa,GAAG,KAAK,EAAE,CAAC,KAAK,SAAS,EAAE;QAC9D,KAAK,EAAE,CAAC;KACT;IAED,OAAO,eAAe,CACpB,qBAAqB,CAAC,OAAO,EAAE,GAAG,aAAa,GAAG,KAAK,EAAE,EAAE,QAAQ,CAAC,CACrE,CAAC;AACJ,CAAC;AAjCD,4DAiCC","sourcesContent":["/**\n * Copyright (c) Microsoft Corporation.\n * Licensed under the MIT License.\n * @format\n */\n\n'use strict';\n\nimport type {NativeModuleObjectTypeAnnotation} from 'react-native-tscodegen';\n\nlet preferredModuleName: string = '';\n\nexport function setPreferredModuleName(moduleName: string): void {\n  preferredModuleName = moduleName;\n}\n\nexport function getAliasCppName(typeName: string): string {\n  return `${preferredModuleName}Spec_${typeName}`;\n}\n\nexport interface AliasMap {\n  types: {[name: string]: NativeModuleObjectTypeAnnotation | undefined};\n  jobs: string[];\n}\n\nconst ExtendedObjectKey = '$RNW-TURBOMODULE-ALIAS';\ninterface ExtendedObject extends NativeModuleObjectTypeAnnotation {\n  '$RNW-TURBOMODULE-ALIAS'?: string;\n}\n\nfunction recordAnonymouseAlias(\n  aliases: AliasMap,\n  baseAliasName: string,\n  extended: ExtendedObject,\n): string {\n  extended[ExtendedObjectKey] = baseAliasName;\n  aliases.types[baseAliasName] = extended;\n  aliases.jobs.push(baseAliasName);\n  return baseAliasName;\n}\n\nexport function getAnonymousAliasCppName(\n  aliases: AliasMap,\n  baseAliasName: string,\n  objectType: NativeModuleObjectTypeAnnotation,\n): string {\n  // someone found an anonymous object literal type\n  // if the ExtendedObjectKey flag has been set\n  // then it is a known one\n  // this happens because method signatures are generate twice in spec and error messages\n  const extended = <ExtendedObject>objectType;\n  const key = extended[ExtendedObjectKey];\n  if (key !== undefined) {\n    return getAliasCppName(key);\n  }\n\n  // if the ExtendedObjectKey flag has not been set\n  // it means it is a unknown one\n  // associate the name with this object literal type and return\n  if (aliases.types[baseAliasName] === undefined) {\n    return getAliasCppName(\n      recordAnonymouseAlias(aliases, baseAliasName, extended),\n    );\n  }\n\n  // sometimes names could be anonymous\n  let index = 2;\n  while (aliases.types[`${baseAliasName}${index}`] !== undefined) {\n    index++;\n  }\n\n  return getAliasCppName(\n    recordAnonymouseAlias(aliases, `${baseAliasName}${index}`, extended),\n  );\n}\n"]}